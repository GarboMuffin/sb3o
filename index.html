<!DOCTYPE html>
<html>
  <head>
    <title>sb3o</title>
    <style>
      body {
        font-family: sans-serif;
      }
    </style>
  </head>
  <body>
    <p>
      <input type="file" accept=".sb3" autocomplete="off">
      <p id="dbg"></p>
      <p><a href="https://github.com/GarboMuffin/sb3o">GitHub</a></p>
    </p>
    <script src="dist/main.js"></script>
    <script>
      document.querySelector('input[type=file]').onchange = (e) => {
        const input = e.target.files[0];
        const fr = new FileReader();
        fr.onload = () => {
          sb3o(fr.result)
            .then((o) => {
              console.log(o);
              const url = URL.createObjectURL(new Blob([o], {type: 'application/x.scratch.sb3'}));
              const link = document.createElement('a');
              link.href = url;
              link.download = input.name.match(/^[^.]*/) + '-optimized.sb3';
              document.body.appendChild(link);
              link.click();
              const inputLength = input.size;
              const outputLength = o.byteLength;
              document.getElementById('dbg').textContent = `Input size: ${inputLength} Output size: ${outputLength} (-${100 - Math.round(outputLength / inputLength * 100)}%)`;
              setTimeout(() => {
                link.remove();
                URL.revokeObjectURL(url);
              }, 500);
            })
            .catch((err) => {
              alert(err);
            });
        }
        fr.readAsArrayBuffer(input);
      };
    </script>
  </body>
</html>
